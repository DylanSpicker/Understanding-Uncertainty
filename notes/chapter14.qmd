# Confidence Intervals

## Interval Estimation and Quantifying Uncertainty
The primary concern with point estimation is that, regardless of the procedure we use, we never expect that $\widehat{\theta}$ will equal the true parameter, $\theta$. Instead, by using statistically valid estimation techniques, we hope to have estimators that are *close* to the truth. Moreover, using the sampling distribution, or assessing the MSE of an estimator can quantify how *close* is close. Still, even the most performant estimators are unlikely to exactly equal the truth. What's more, reporting the estimated value will not, on its own, convey any information about the reliability of the estimator. To solve these issues we can turn to **interval estimation**. Specifically, with interval estimation we form estimators that do not give a single value for a parameter of interest, but rather, a range of plausible values.

:::{#def-interval-estimator}
## Interval Estimator
An interval estimator is a mathematical procedure (function) that takes in observable data (from a sample) and outputs an estimated range for a parameter value. Interval estimators are specific to the parameter that they are attempting to estimate.
:::

There are several types of interval estimators, including confidence intervals, credible intervals, likelihood intervals, and prediction intervals. Confidence intervals are rooted in frequentist probability theory, the framework we have been exploring throughout, and will serve as the primary focus of this chapter.^[Credible intervals are similar to confidence intervals, but approached through the Bayesian paradigm. Likelihood intervals are related to maximum likelihood estimation, and provide a rather interpretable framework for interval estimation. Prediction intervals, as the name suggests, are related to predictive statistics and allow the uncertainty of predictions to be quantified.] With any interval estimator the goal is to not only provide an estimate of the likely value of a parameter, but also to quantify the uncertainty around this estimate. Providing the interval communicates that, while it is suspected that the parameter is near the point estimate, it is not possible to be entirely sure of exactly where. When reported intervals are more narrow, there is a higher level of precision attributed to the estimate. When reported intervals are wider, there is less certainty ascribed to the estimate. As a result, interval estimates convey a significant amount of information about the parameter, and the estimation procedure that was used.

## Confidence Intervals in General
Ideally, we would like to be able to form an interval that has a direct probability statement associated with it. For instance, we may wish to form an interval, $(a, b)$, such that $P(\theta \in (a, b))$ is known explicitly. Unfortunately, in the frequentist paradigm, $\theta$ is not a random quantity. The statement $P(\theta \in (a, b))$ is akin to writing $P(2 \in (4, 6))$: this probability is either $0$ or it is $1$.^[In this case, it is zero since $2$ is not in the interval $(4, 6)$.] We need to hold in mind that the uncertainty in estimation does not stem from the parameter value, $\theta$, and instead stems from the estimator, $\widehat{\theta}$ (and its sampling distribution).

The statement $P(\widehat{\theta} \in (a, b))$ can be interpreted as a sensible probability, where here the probability is taken with respect to the sampling distribution. To form our confidence intervals, we start with this idea. Specifically, we attempt to find values $a$ and $b$ such that $P(a \leq \widehat{\theta} \leq b) = p$ for some suitably high threshold, $p$. This interval, $(a, b)$, can be thought of as an interval that will contain the estimated value with high probability. If $p=0.95$ then, based on the sampling distribution, there is a $95\%$ chance that the computed estimator will fall between $a$ and $b$.

Note that this interval, $(a, b)$ is not yet an interval for the true parameter; it is an interval for our estimator. However, it will almost always be the case that the endpoints of the interval, $a$ and $b$, depend on the parameters of the sampling distribution. Recall that the sampling distribution's parameters are connected to the population distribution's parameters, and so we can view $a$ and $b$ as depending directly on $\theta$. To emphasize this point, we write $$P\left(a(\theta) \leq \widehat{\theta} \leq b(\theta)\right) = p.$$ It is important to remember that, in this expression, the only random quantity is $\widehat{\theta}$. However, we have an expression that we know will be true with high probability, that contains both $\theta$ and $\widehat{\theta}$. We can exploit this to form confidence intervals.

The lower bound of our interval occurs where $a(\theta) = \widehat{\theta}$. Note that $a$ is some function of $\theta$, and so we can think of the *inverse function* of $a$, and apply it to both sides.^[Recall that an inverse function is the function, $f^{-1}$ such that $f^{-1}(f(x)) = x$. So if $f(x) = \log(x)$, then $f^{-1}(x) = \exp(x)$. If $f(x) = x$ then $f^{-1} = \frac{1}{x}$ and so forth.] That is, $$a^{-1}(a(\theta)) = a^{-1}(\widehat{\theta}) \implies \theta = a^{-1}(\widehat{\theta}).$$ Similarly, applying the same rationale with $b^{-1}$ to the upper bound on the interval provides a secondary bound, $\theta = b^{-1}(\widehat{\theta})$. 

:::{#exm-equivalence-of-intervals}
## Car Washes for Charity
Charles and Sadie have decided that, to raise money for the local animal shelter, they will run a car wash. They recognize that the main cost in running the car wash is the water used for it, and that the key variable in terms of throughput of their cash wash is the time it takes for a car to be cleaned. They are trying to determine how to price and time their washes. Charles suggests that they should aim for using between $100$ and $300$ liters to wash a car, and Sadie notes that the amount of water being used is likely $5T + 10$ liters, where $T$ is the time in minutes. 

Given this information, what is the equivalent interval for the time per car through their car wash?

::::{.callout .solution collapse='true'}
## Solution

Note that we are told $$100 \leq 5T + 10 \leq 300.$$ We can invert this interval to find an interval for $T$ instead. Thus, we get $100 \leq 5T + 10$ which means $T \geq 18$. Similarly, $5T + 10 \leq 300$ means that $T \leq 58$. Thus, if the interval for water use is $(100, 300)$, then the interval for time will be $(18, 58)$ minutes. 

::::
:::

Taken together this means that whenever $\widehat{\theta}$ falls in the interval with endpoints $a(\theta)$ and $b(\theta)$, it is equivalent to say that $\theta$ falls in the interval with endpoints $a^{-1}(\widehat{\theta})$ and $b^{-1}(\widehat{\theta})$.^[Note that very often we will find that $a^{-1}(\widehat{\theta}) \geq b^{-1}(\widehat{\theta})$, and so the endpoints *switch*. This is not always the case, but frequently occurs.] Thus, if we know that $\widehat{\theta}$ falls between $a(\theta)$ and $b(\theta)$ with probability $p$, this is mathematically equivalent to saying that $\theta$ falls between $a^{-1}(\widehat{\theta})$ and $b^{-1}(\widehat{\theta})$ with probability $p$ as well. This inverted interval gives the confidence interval for $\theta$.

:::{#def-confidence-interval}
## Confidence Interval
A confidence interval for the parameter $\theta$ is an interval given by $(L(\widehat{\theta}), U(\widehat{\theta})$ such that $$P(L(\widehat{\theta}) \leq \theta \leq U(\widehat{\theta})) = p,$$ for some set level of $p$. Often the confidence interval will be expressed in terms of $p=1-\alpha$, where $\alpha$ is referred to as the level of significance. It is important to note that in this expression, $L(\widehat{\theta})$ and $U(\widehat{\theta})$ are random quantities, where $\theta$ is fixed. Correspondingly, the confidence probability can be written as $$P(L(\widehat{\theta}) \leq \theta \leq U(\widehat{\theta})) = P(L(\widehat{\theta}) \leq \theta,  U(\widehat{\theta}) \geq \theta) = p.$$
:::

Conceptually, a confidence interval provides an interval that, prior to conducting our estimation, we know there is a set threshold for the probability that the true parameter falls within its bounds. In our framing of the confidence intervals the random variables are $U(\widehat{\theta})$ and $L(\widehat{\theta})$ corresponding to $a^{-1}(\widehat{\theta})$ and $b^{-1}(\widehat{\theta})$. These can be viewed more generally as $U(X_1, X_2, \dots, X_n)$ and $L(X_1, X_2, \dots, X_n)$, being functions of the random sample. In this sense, both $U$ and $L$ are point estimators themselves. However, instead of estimating the parameter value directly, they are estimating upper and lower bounds for the parameter value. This is important to keep in mind since, fundamentally, it is the estimator that is random,^[With its randomness endowed thanks to the random sampling] not the parameter. 

It is theoretically possible that there are many estimators, $U$ and $L$, that would satisfy the given probability statements. We generally need some manner of choosing which interval to use. The most important feature of any confidence interval is the length, which is to say $U(\widehat{\theta}) - L(\widehat{\theta})$. All else equal, we prefer shorter intervals, since these give a more precise estimate of the true parameter value. We typically constrain our confidence interval definition to be such that $U(\widehat{\theta}) - L(\widehat{\theta})$ is as small as possible, and select estimators that achieve this optimality. 

:::{#exm-multiple-intervals}
## Charles Tufts a Rug

Charles has become very intrigued by tufting, making rugs using yarn, but is still learning, and has not fully calibrated the amount of yarn required for each project. For the size of rugs that Charles has been making, the internet states that the amount of yarn used per rug (measured in kg) can be thought of as coming from a $N(5, 1)$ distribution. 

Charles wants to use this information to be confident in the average amount of yarn used, per rug, for the next $9$ rugs made. With the help of Sadie, they determine three possible intervals:

1. $(4, 5)$.
2. $(5, 6)$.
3. $(4.77596, 5.22404)$.

a. Work out the approximate level of confidence that they should have in each interval. Note that $\Phi(0.67212) \approx 0.7492463$. 
b. Which of these intervals is the best to take as the basis of a confidence interval for Charles to use? Explain.

::::{.callout .solution collapse='true'}
## Solution

a. Note that the next $9$ rugs will have a sampling distribution given by $N(5, \frac{1}{9})$. We can compute the probability of each interval on this basis. Specifically, $$P(4 \leq \overline{X} \leq 5) = P(\frac{4-5}{1/3} \leq Z \leq 0) = \Phi(0) - \Phi(-3).$$ Note that, using the empirical rule we know that this is going to be approximately $\frac{0.997}{2} = 0.4985$. The calculation for the second interval proceeds exactly the same way, giving $\Phi(3) - \Phi(0) \approx 0.4985$ by the empirical rule. For the third interval we take $$\begin{split}P(4.77596 \leq \overline{X} \leq 5.22404) = P(\frac{4.77596-5}{1/3} \leq Z \leq \frac{5.22404-5}{1/3}) \\ = \Phi(0.67212) - \Phi(-0.67212).\end{split}$$ From the question hint we have that $\Phi(0.67212) \approx 0.7492463$, and $\Phi(-0.67212) \approx 1 - 0.7492463.$ Thus, taken together the coverage of the third interval is $$0.7492463 - (1 - 0.7492463) = 0.4984926 \approx 0.4985.$$ All three intervals have the same coverage. 
b. The third interval will be preferred. Each of the intervals gives the same coverage probabilities and the same level of confidence can be placed in all three of them. Thus, the main point of differentiation stems from the width of the intervals. The first two have a width of $1$, whereas the third is $0.448$ wide. This is less than half the width, with the same overall level of confidence. This allows Charles to have a more precise estimate of the amount of yarn used, without sacrificing the level of confidence in that estimate.  
::::
:::

## Interpretation of Confidence Intervals
The construction of the confidence interval follows a fairly natural idea. We want an interval with a high probability of containing the truth, and so we start with an interval for our estimator and invert this to have an interval for the parameter. This procedure, while intuitive in construction, obscures the nuance in the probability statements that we can make. We must be very careful in the interpretation of a confidence interval.

Recall that the random component in the interval is the endpoints, $U$ and $L$. These endpoints are estimators, and so the probability distribution associated with them is the sampling distribution of the estimators. Sampling distributions capture the behaviour of an estimator when we repeatedly draw samples and compute estimates on those samples. Thus, $P(L \leq \theta \leq U) = p$ means that, if we were to repeatedly draw samples from the population, use those samples to compute $L(\widehat{\theta})$ and $U(\widehat{\theta})$, and then check whether $L(\widehat{\theta}) \leq \theta \leq U(\widehat{\theta})$ holds, in the long-run $p$ proportion of those runs would satisfy this condition. This is how we must interpret the confidence intervals.

Formally, a $100p\%$ confidence interval interpreted by noting that, were this procedure to be repeated across many, many samples, the proportion of these samples that contain the true parameter will tend towards $p$ as the number of samples tends towards $\infty$. Note that this is **not** a statement regarding any specific confidence interval, but rather, it is a statement regarding the procedure of constructing the confidence intervals. 

As an alternative framing, we can consider applying the procedure in practice. Suppose that we have yet to take our sample, but we know that we will form the confidence interval as $\left(L(\widehat{\theta}), U(\widehat{\theta})\right)$. Prior to observing any data, we know that this procedure will have a $p$ probability of containing the true parameter, $\theta$. However, once we collect data and compute the values, we get $L(\widehat{\theta}) = \ell$ and $U(\widehat{\theta}) = u$ for some fixed values $\ell$ and $u$. Now, the statement $P(\ell \leq \theta \leq u)$ is either equal to $1$, if $\ell \leq \theta \leq u$ holds, or it is equal to $0$ otherwise. We do not know whether it is $0$ or it is $1$, but we do know that the probability is not $p$. 

:::{#exm-confidence-interval-interpretation-incorrect}
## The Probability of Rolling a Six
Charles is working hard to truly understand the valid, and invalid, ways of interpreting confidence intervals. Sadie, who seems to have understood the concepts more thoroughly, is trying to help. Charles is particularly hung up on the idea that the process itself can be interpreted probabilistically, even when the specific interval that is formed cannot. Sadie, recognizing that this is the hang-up, works through the following thought experiment with Charles. Sadie asks the following questions.

a. Suppose that I have a fair die in my hand. Before I have rolled it, what is the probability that the die shows a $6$?
b. Once the die is rolled, and the die is showing a $5$, what is the probability that the die shows a $6$?
c. If instead, after the die were rolled, it showed a $6$, what is the probability that the die shows a $6$?
d. What can we say about the probability that the die shows a $6$, in general, after it is rolled?
e. How does this relate to the confidence interval interpretation? 

::::{.callout .solution collapse='true'}
## Solution
a. Before the die is rolled, because it is a fair die, the probability it shows a $6$ is $\dfrac{1}{6}$. This is precisely what we mean by the fact that the die is fair. 
b. If the die is rolled, and it shows a $5$, the probability that it equals $6$ is $0$. That is, once it does not equal $6$, we know for certain it is not $6$.
c. If the die is rolled, and it shows a $6$, the probability that it equals $6$ is $1$. That is, once it does equal $6$, we know for certain that it is $6$. 
d. After the die is rolled, the probability will be either $0$ or it will be $1$, depending on whether it was a $6$ or not. We do not know until we have observed it whether it is $0$ or it is $1$, but necessarily one of those probabilities is the truth. 
e. In a confidence interval, the probability is not attributed to the specific interval, but rather to the process. Relating to the die example, the specific realization that is shown after the die is rolled is analogous to the specific interval. We know that depending on whether we see a $6$ or it is not the probability is $1$ or $0$. Similarly, once computed, a specific interval has either $0$ or $1$ probability of containing the truth. Still, the process through which the interval was formed produces a predictable probability of forming intervals with the true value, just as the process of rolling the die produces predictable probabilities of showing $6$. 

::::
:::

The confidence threshold in a confidence interval relates to the procedure, not to any specific interval produced by that procedure. That is, we can put our confidence in constructing intervals in this way knowing that, if we always follow this procedure, over time our intervals will be correct in a specific proportion of cases. However, we cannot use this to make claims about any specific confidence interval. We do not know in any given sample whether the interval is one that contains the truth, or one that does not. In fact, we cannot know this, without learning what the true parameter value is. 

This makes confidence intervals clunky to interpret. Notably, the interpretation of a confidence interval never makes reference to the specific interval that we have computed. Instead, the interpretation of the confidence interval gives a description of the procedure that created the interval, and ascribes a level of confidence to this underlying procedure.^[Note that it is not uncommon to see that an interval is interpretable as "We are $100p\%$ confident that the parameter is in the interval." This confidence is, importantly, not a probability, and this is taken as shorthand to mean that, if we were to repeatedly find confidence intervals following this practice, in $100p\%$ of them we would find the truth. I think that this statement tends to lead to more confusion, and as such, I would advise against this interpretation until you are *very* confident in your understanding.]

Further misconceptions of confidence intervals commonly occur. For instance, individuals will commonly interpret a confidence interval to mean that $p$ proportion of the sample data lie within the interval. This is incorrect for two reasons. First, the confidence interval is a statement regarding an estimator or parameter value, rather than the sample value itself. From the same sample you can calculate different confidence intervals for different parameters.^[For instance, we will see how to calculate confidence intervals for both the mean and the variance of a random sample. These will be different and are disconnected from the sample values.] Second, this interpretation further relies on the thought that a confidence interval is interpreted specific to a particular sample. This is not the case.

Alternatively, individuals may misinterpret a confidence interval as stating that, were we to repeatedly sample from the population and compute the estimator, in $p$ proportion of these trials the estimated value will be contained in the interval we have computed. This misinterpretation is appealing as it seems to use the repeated draws from the population. However, note two concerns. First, this interpretation also relies on giving interpretation to the specific interval that we have computed, which the correct interpretation cannot. Second, this interpretation makes a probability statement regarding the estimator, rather than the parameter (or the endpoints of the interval). Remember that $U$ and $L$ are the random components, and they are calibrated such that $P(L \leq \theta \leq U) = p$. This is not a probability statement relating to where the estimate is likely to show up, rather one regarding the true value.

:::{#exm-ci-interpretation}
## Bird Watching Confidence

Sadie and Charles have continued their bird watching adventures. As their statistical knowledge has expanded, they have continued to integrate this new-found knowledge into their trips. Lately, they have begun to consider confidence intervals, and so with a little help from their friend Garth, they work out the confidence interval for the average number of rare birds at a particular location that they enjoy traveling to. They find that the $90\%$ confidence interval is given by $(1.4, 8.5)$. Seeing as confidence intervals are still new to them, they start trying to work out the interpretation of this statement together. Help them out by answering their questions, with explanations.

a. Charles wonders, "Does this mean that, if we go, there is a $90\%$ chance we will see between $1.4$ and $8.5$ rare birds?"
b. Sadie responds, questioning "Perhaps it means that, if we go many, many, many times, in $90\%$ of cases we will see in this range?"
c. Charles questions, "Could it mean that, from the sample data we have collected, $90\%$ of observations fall between $1.4$ and $8.5$?"
d. Sadie follows up, "Or that, if we were to perform the sampling many times, and calculate the sample average for each of those, then $90\%$ of sample averages should fall between $1.4$ and $8.5$?"
e. What does it actually mean?

::::{.callout .solution collapse='true'}
## Solution


a. This does not mean that there is a $90\%$ chance we will see between $1.4$ and $8.5$ birds. The concern here is that we cannot apply the interpretation to any specific interval. Instead, we need to be thinking about the procedure generating the interval. There is a $90\%$ chance that the procedure generates an interval that is valid, but we cannot know about any specific interval we are looking at. 
b. This statement is just a rephrasing of Charles' first statement. To have a $90\%$ chance of seeing between $1.4$ and $8.5$ rare birds is to say that, if you observe birds many, many times, then in $90\%$ of those cases you observe in that range. It is an incorrect interpretation for the same reason as above. 
c. No. Confidence intervals are never making comments about what has been observed in the sample, they are instead designed to be inferential about the population at large. We are not capturing information about past samples. The other important note is that, this is a confidence interval for the mean, not for the observations themselves.
d. Again, this is a tempting misinterpretation. Here, Sadie has the correct idea of repeatedly performing experiments, however, the idea is not that in repeated experiments the current interval will contain the sample mean. Rather, in repeated experiments, the computed interval will contain the true mean. That is, once again, we need to focus on the population mean not the sample values, and we need to focus on the procedure, not the specific interval. 
e. This confidence interval is not interpreted on its own. However, we can say that, were we to continue to make observations and use these observations to compute confidence intervals, following the exact same procedure, in $90\%$ of those cases we would find an interval that contains the truth. We can also say, practically, that there is a fair amount of variability in the number of birds that are likely to be seen, and so Charles and Sadie should likely prepare themselves for the possibility of wide swings between different trips. An alternative way of interpreting the interval is to note that, before any data were analyzed, the probability that they would calculate an interval containing the truth was $0.9$.

::::
:::

In practice, the utility of reporting a confidence interval is that it conveys a sense of uncertainty. Wider intervals suggest that we should put less assurance in the value of the point estimate than more narrow intervals. Moreover, given a confidence interval, there is little reason to think that one value in this interval is more likely to correspond to the truth than any other value. We can use the intervals to determine whether decisions that are made on the basis of estimation would be made under all scenarios implied by the interval. If conclusions differ assuming that $\theta = U$ compared to $\theta = L$, care should be put into making more conservative decisions, since based on the sample there is little reason to differentiate between these points. 

## Confidence Intervals for the Mean
While confidence intervals can be derived for any parameter of interest, as previously discussed, we are very commonly interested in the means of populations. Moreover, owing to the Central Limit Theorem, the sampling distribution of a sample mean is often easy to approximate. We will primarily focus on confidence intervals for the means of distribution. We differentiate the procedure based on whether the population is itself normally distributed or not.

### Confidence Intervals in Normal Populations
If our population is normally distributed then the sample mean is known to be exactly normally distributed as well. The sampling distribution depends on both the population mean, $\mu$, and on the population variance, $\sigma^2$. Suppose that we wanted to determine $P(a \leq \overline{X} \leq b)$, for some values $a$ and $b$, then we know that $$P(a \leq \overline{X} \leq b) = P\left(\frac{a - \mu}{\sigma/\sqrt{n}} \leq Z \leq \frac{b - \mu}{\sigma/\sqrt{n}}\right) = \Phi\left(\frac{b - \mu}{\sigma/\sqrt{n}}\right) - \Phi\left(\frac{a - \mu}{\sigma/\sqrt{n}}\right).$$

If $\sigma^2$ is known then we can use the percentiles of the standard normal distribution to solve for what $a$ and $b$ would have to be. Specifically, if we take the two endpoints to be symmetric, then we want to solve for $$\Phi\left(\frac{b - \mu}{\sigma/\sqrt{n}}\right) = 1 - \frac{1-p}{2},\quad\text{and}\quad\Phi\left(\frac{a - \mu}{\sigma/\sqrt{n}}\right) = \frac{1-p}{2}.$$ If we did this then we would find that $$P(a \leq \overline{X} \leq b) = 1 - \frac{1-p}{2} - \frac{1-p}{2} = p,$$ as desired.

To solve for these quantities, we note that these are exactly the quantiles of the standard normal distribution. That is, \begin{align*}\Phi\left(\frac{b - \mu}{\sigma/\sqrt{n}}\right) &= 1 - \frac{1-p}{2} \implies \frac{b - \mu}{\sigma/\sqrt{n}} = Z_{1 - \frac{1-p}{2}}, \\ 
\Phi\left(\frac{a - \mu}{\sigma/\sqrt{n}}\right) &= \frac{1-p}{2} \implies \frac{a - \mu}{\sigma/\sqrt{n}} = Z_{\frac{1-p}{2}}.\end{align*} Note that, by symmetry, $Z_{(1-p)/2} = -Z_{1 - (1-p)/2}$, so we take $$Z_{(1-p)/2}\frac{\sigma}{\sqrt{n}} + \mu \leq \overline{X} \leq Z_{1-(1-p)/2}\dfrac{\sigma}{\sqrt{n}} + \mu.$$ This interval can then be inverted to give an interval for $\mu$. Namely, \begin{align*}
Z_{(1-p)/2}\frac{\sigma}{\sqrt{n}} + \mu &\leq \overline{X} \\
\implies \mu &\leq \overline{X} - Z_{(1-p)/2}\frac{\sigma}{\sqrt{n}} \\
&= \overline{X} + Z_{1 - (1-p)/2}\frac{\sigma}{\sqrt{n}} \\ 
\overline{X} \leq Z_{1-(1-p)/2}\dfrac{\sigma}{\sqrt{n}} + \mu \\
\implies \overline{X} - \leq Z_{1-(1-p)/2}\dfrac{\sigma}{\sqrt{n}} &\leq \mu.
\end{align*} 

These two bounds give rise to the confidence intervals for the mean of a normal population, when $\sigma$ is known. 

:::{.callout-tip icon="false"}
## Confidence Intervals for the Mean (Known $\sigma$ in a Normal Population)
If a population is known to be normally distributed, with a known population standard deviation, $\sigma$, then a $100p\%$ confidence interval for the mean is given by $$(\overline{X} - \leq Z_{1-(1-p)/2}\dfrac{\sigma}{\sqrt{n}}, \overline{X} + Z_{1 - (1-p)/2}\frac{\sigma}{\sqrt{n}}).$$ This is often expressed as $$\overline{X} \pm Z_{(1-p)/2}\frac{\sigma}{\sqrt{n}}.$$
:::

:::{.callout-warning icon="false"}
## Common Normal Critical Values 

When introducing the normal distribution, we discussed the percentiles of the normal as normal critical values. We discussed how these can be found using the `qnorm` function in R. In most introductory statistics references, they will contain tables of normal critical values, giving the mappings between the $Z$ values and their probabilities. The following are commonly used $Z$ values, provided for reference. 

```{r}
#| echo: false
#| tbl-colwidths: [5, 5, 5, 5]

knitr::kable(
        data.frame(
                "$\\alpha$" = c(0.005, 0.01, 0.025, 0.05, 0.1),
                "$Z_{\\alpha}$" = round(qnorm(c(0.005, 0.01, 0.025, 0.05, 0.1)), 2),
                "$\\alpha$" =  rev(c(0.9, 0.95, 0.975, 0.99, 0.995)),
                "$Z_{\\alpha}$" = rev(round(qnorm(c(0.9, 0.95, 0.975, 0.99, 0.995)), 2)),
                check.names = FALSE
        ), align = "c"
)
```

:::


:::{#exm-mean-ci-known-variance}
## Charles' Nap Times
Charles is a frequent napper. Sadie, on the other hand, cannot take naps at all. Sadie often has a significant amount of boredom while Charles naps away, and so Sadie starts to record the lengths of the naps that Charles takes, in minutes. Over the last $5$ days, Charles' naps have been: $$33.2, \ 29.6, \ 29.7, \ 31.7, \ 29.1.$$

a. What is an estimate for the average length of Charles' naps?
b. Sadie assumes that Charles' naps are normally distributed, with a variance of $4$. Find a $90\%$ confidence interval for the average nap length.
c. Using the same assumptions, find a $95\%$ confidence interval for the average nap length. 
d. How would an $80\%$ confidence interval compare? A $99.9\%$ interval? Explain.

::::{.callout .solution collapse='true'}
## Solution

a. We can use the sample average to estimate the population average. This is given by $$\frac{1}{5}\left(33.2 + 29.6 + 29.7 + 31.7 + 29.1\right) = 30.66$$
b. Assuming normality and with known variance, we can take $$\overline{X} \pm Z_{(1-p)/2}\frac{\sigma}{\sqrt{n}}.$$ Here, $\sigma = 2$, $\sqrt{n} = \sqrt{5}$, $\overline{X} = 30.66$. For a $90\%$ confidence interval, we have $(1 - 0.9) / 2 = 0.05$, and thus $Z_{(1-p)/2} = -1.64$. We get $$30.66 \pm 1.64\frac{2}{\sqrt{5}} = (29.19, 32.13).$$
c. For a $95\%$ confidence interval, we change the critical value to be given by $Z_{(1-0.95)/2} = -1.96$. Thus, $$30.66 \pm 1.96\frac{2}{\sqrt{5}} = (28.91, 32.41).$$
d. As the confidence level increases, the width of the confidence level must also increase. Thus, we should find that an $80\%$ confidence interval is more tightly centered around $30.66$ and a $99.9\%$ confidence interval is more widely spread out. Indeed, using `R` we can find these to be $(`r round(c(30.66 - qnorm(0.9) * 2 / sqrt(5), 30.66 + qnorm(0.9) * 2/sqrt(5)), 2)`)$ for the $80\%$ interval, and $(`r round(c(30.66 - qnorm(0.9995) * 2 / sqrt(5), 30.66 + qnorm(0.9995) * 2/sqrt(5)), 2)`)$ for the $99.9\%$ interval.

::::
:::

If the variance is not known, then this procedure cannot be followed directly. An obvious alteration to make is to substitute $s^2$ for $\sigma^2$ in the expression for the confidence interval. However, if we consider the quantity $$\frac{\overline{X} - \mu}{s/\sqrt{n}},$$ this will no longer follow a normal distribution. Instead, assuming that $\overline{X}$ is normally distributed, this ratio follows a $t$ distribution with $n-1$ degrees of freedom. Otherwise, the same procedure can be followed, this time needing the critical values from the $t_{n-1}$ distribution rather than the standard normal distribution. 

:::{.callout-tip icon="false"}
## Confidence Intervals for the Mean (Unknown $\sigma$ in a Normal Population)
If a population is known to be normally distributed, with an unknown population standard deviation, then a $100p\%$ confidence interval for the mean is given by $$(\overline{X} - \leq t_{n-1, 1-(1-p)/2}\dfrac{s}{\sqrt{n}}, \overline{X} + t_{n-1, 1 - (1-p)/2}\frac{s}{\sqrt{n}}).$$ This is often expressed as $$\overline{X} \pm t_{n-1, (1-p)/2}\frac{s}{\sqrt{n}}.$$
:::

:::{#exm-mean-ci-unknown-variance}
## Charles Continues Napping
Charles has maintained the pattern of daily naps. Sadie, understanding more about confidence intervals, decides to revisit the intervals for the length of Charles' naps. This time, instead of assuming that the variance is known to be $4$, Sadie wants to leverage the same data as was used to find the mean. Specifically, Sadie has recorded that over a $5$ day stretch, the length of Charles' naps have been: $$33.2, \ 29.6, \ 29.7, \ 31.7, \ 29.1.$$ While Sadie does not want to presume that the variance is known, for now, the assumption of normality still feels reasonable.

a. What is the sample variance?
b. Using the sample variance, how could Sadie construct a $90\%$ confidence interval for the mean?
c. What critical value would need to be used to calculate a $95\%$ confidence interval in this case? A $99\%$ one? 

::::{.callout .solution collapse='true'}
## Solution

a. For the sample variance, we calculate $$\begin{split}\frac{1}{5-1}\left((33.2 - 30.66)^2 + (29.6-30.66)^2 + (29.7 - 30.66)^2 \right.\\
\left. + (31.7 - 30.66)^2 + (29.1 - 30.66)^2\right) = 3.003.\end{split}$$
b. Since the population is normally distributed, with an unknown variance, Sadie can use the form $$\overline{X} \pm t_{n-1,(1-p)/2}\frac{s}{\sqrt{n}},$$ to form confidence intervals. Here, $\overline{X} = 30.66$, $n = 5$, $s = \sqrt{3.003}$, and $p=0.9$. Thus, the critical value to use is the $t_{4, 0.05}$ value, and the form of the interval will be $$30.66 \pm t_{4, 0.05}\sqrt{\frac{3.003}{5}} = 30.66 \pm t_{4, 0.05}\sqrt{0.6006}.$$ Using `R`, we can call `qt(0.05, 4)` to determine that the critical value is approximately `r round(qt(0.05, 4), 2)`, to fill in for the specific value of $t_{4, 0.05}$. 
c. Here we would still reference the $t$ distribution with $4$ degrees of freedom, but now instead of the $0.05$ percentile, we would need to look at either the $0.025$ or $0.005$ percentiles. This would give, $t_{4, 0.025} \approx `r round(qt(0.025, 4), 2)`$ and $t_{4, 0.005} \approx `r round(qt(0.005, 4), 2)`$.

::::
:::

In both scenarios, the confidence interval forms a symmetric interval around the estimated mean, $\overline{X}$, and is based on critical values from the relevant sampling distribution. If $n$ is sufficiently larger than $t_{n-1, \alpha} \approx Z_{\alpha}$, and so in these cases it is sometimes acceptable to use the $Z$-based intervals, as though $\sigma$ were known. These intervals are justified on the basis of the population being normally distributed. What if this is not an assumption we can make?

### Confidence Intervals in Non-Normal Populations
When populations are non-normal, there are two possible techniques for forming confidence intervals for the mean. In the first, we can attempt to use the assumed population distribution to derive an exact confidence interval for the mean, based on the true sampling distribution. This would need to be worked out for every individual population distribution, and would be valid only for that distribution. Alternatively, if our sample sizes are large enough, then we can use the Central Limit Theorem to indicate that $\overline{X}$ will be approximately normally distributed. In this case, we can follow the same procedures outlined above. Note that doing so will not give **exact** confidence intervals, instead settling for **approximate** confidence intervals. These are often reliable enough in practice. 

:::{.callout-tip icon="false"}
## Approximate Confidence Intervals for the Mean
For a sufficiently large sample size, such that Central Limit Theorem applies, a $100p\%$ confidence interval for the mean is given by $$(\overline{X} - \leq t_{n-1, 1-(1-p)/2}\dfrac{s}{\sqrt{n}}, \overline{X} + t_{n-1, 1 - (1-p)/2}\frac{s}{\sqrt{n}}).$$ This is often expressed as $$\overline{X} \pm t_{n-1, (1-p)/2}\frac{s}{\sqrt{n}}.$$
:::

:::{#exm-mean-ci-non-normal}
## Charles' Naps are Not Normal
Sadie realizes that the assumption that Charles' nap lengths are normally distributed may not be correct, and begins to wonder how this may impact the calculations that have been done before. Recall that previously Sadie had recorded $5$ nap lengths for Charles, giving $$33.2, \ 29.6, \ 29.7, \ 31.7, \ 29.1.$$

a. Can Sadie use these data, assuming that they are not normal, to compute a confidence interval for the mean length of Charles' naps? Explain.
b. Suppose that Sadie records data over two months, giving $n=60$. Over this time, the mean nap length is $31.10$ and the standard deviation is $8.61$. How may Sadie use this information to construct a $100p\%$ confidence interval for the length of the nap. 
c. Given that $n$ is fairly large, what will be the approximate value of the critical value needed for a $95\%$ confidence interval? Use this to write down an approximate $95\%$ confidence interval.

::::{.callout .solution collapse='true'}
## Solution

a. No. The issue is that, without normality, we rely on the Central Limit Theorem to form the confidence intervals. However, in order for the CLT to apply, we must have a large enough sample. A sample of size $5$ is not going to be large enough to invoke the CLT, and as a result, we either need to make other assumptions about the population, or else collect more data. 
b. In this case, we can use the CLT to form the confidence interval. Namely, we get $$\overline{X} \pm t_{n-1, (1-p)/2}\frac{s}{\sqrt{n}} = 31.10 \pm t_{59, (1-p)/2}\frac{8.61}{\sqrt{60}}.$$ Here the critical values come from the $t_{59}$ distribution, and could be computed for any level of interest. 
c. When $n$ is large, we get that $t_{n, \alpha} \approx Z_{\alpha}$. Because of this, we can take the critical value to be approximately $Z_{0.025} = -1.96$.^[Note, in this case, the true value would be $`r round(qt(0.025, 59), 2)`$, which is fairly close.] Using this value we get $$31.10 \pm 1.96\frac{8.61}{\sqrt{60}} = (`r round(c(33.1 - 1.96*8.61/sqrt(60), 33.1 + 1.96*8.61/sqrt(60)), 2)`).$$
::::
:::

We previously discussed how, in the event of having data from a binomial experiment, we can view the estimator of the success probability, $\widehat{p}$ as a sample mean. This means that, supposing that we wish to find a confidence interval for a proportion, we can follow fundamentally the same procedure. A key distinction here is that, in the case of binomial data, the estimated variance is not $s^2$ but rather $n\widehat{p}(1 - \widehat{p})$. Practically, this means that we can use the standard normal critical values for our confidence intervals, rather than the $t$ values.^[Note that, for large $n$ these two sets of values are essentially equivalent. This means that if you had used the $t$ values, it would not result in meaningfully different results, however, the $Z$ values are justified in this setting.] 

:::{.callout-tip icon="false"}
## Approximate Confidence Intervals for a Proportion
For a sufficiently large sample size, such that Central Limit Theorem applies, a $100p\%$ confidence interval for a proportion is given by $$(\widehat{p} - Z_{1-(1-p)/2}\sqrt{\dfrac{\widehat{p}(1-\widehat{p})}{n}}, \overline{X} + Z_{1 - (1-p)/2}\sqrt{\dfrac{\widehat{p}(1-\widehat{p})}{n}}).$$ This is often expressed as $$\widehat{p} \pm Z_{(1-p)/2}\sqrt{\dfrac{\widehat{p}(1-\widehat{p})}{n}}.$$
:::

## Confidence Intervals for the Variance
It is important to recognize that, while the formulae for confidence intervals for the means are used frequently, the process of forming a confidence interval is equivalent regardless of the parameter that is under consideration. Generally, a confidence interval can be found by first finding an interval around the estimator, and then inverting this interval to form one around the parameter value. The key step in this process is determining the sampling distribution for the relevant statistic. As such, when learning confidence intervals, it is best to focus on the overarching procedure and understand where each formula is coming from, rather than specifically pattern matching to find which formula to use. When considering the mean, we use the $Z$ or $t$ critical values depending on whether the sampling distribution follows a normal or a $t$ distribution. Recognizing this enables confidence intervals for any parameters for which the sampling distribution is known.

As an example of how this procedure can be applied, consider taking a normal population, and forming a confidence interval for the variance. In order to do so, we would first want to find an interval around $S^2$ that would hold with probability $p$, and then invert this interval. This relies on knowledge of the sampling distribution of $S^2$. 

:::{.callout-note icon="false"}
## The Sampling Distribution of $S^2$

If the population is normally distributed, with mean $\mu$ and variance $\sigma^2$, then the sampling distribution of $$S^2 = \frac{1}{n-1}\sum_{i=1}^n (x_i - \overline{x})^2,$$ can be derived by noting that $$\frac{(n-1)}{\sigma^2}S^2 \sim \chi^2_{n-1}.$$ This is, notably, not precisely the sampling distribution of $S^2$ directly, however, it can be manipulated to give probability statements regarding $S^2$. 
:::

Using this result, we can then form a confidence interval for $S^2$. We start by finding constants, $a$ and $b$, such that $$P(a \leq S^2 \leq b) = p \implies P\left(\frac{(n-1)a}{\sigma^2} \leq \frac{(n-1)S^2}{\sigma^2} \leq \frac{(n-1)b}{\sigma^2}\right) = p.$$ Noting the sampling distribution, we require $$\frac{(n-1)a}{\sigma^2} = \chi^2_{n-1,(1-p)/2} \quad\text{and}\quad \frac{(n-1)b}{\sigma^2} = \chi^2_{n-1,1-(1-p)/2}.$$ Unlike the normal distribution, the chi-squared distribution is not symmetric, and the critical values will not be equal in magnitude. We can take this interval for $S^2$, and solve it for $\sigma^2$ instead. Doing so gives $$\chi^2_{n-1,(1-p)/2} \leq \frac{(n-1)S^2}{\sigma^2} \implies \sigma^2 \leq \frac{(n-1)S^2}{\chi^2_{n-1,(1-p)/2}} = U(S^2),$$ as the upper bound on the confidence interval, and $$\frac{(n-1)S^2}{\sigma^2} \leq \chi^2_{n-1,1-(1-p)/2} \implies L(S^2) = \frac{(n-1)S^2}{\chi^2_{n-1,1-(1-p)/2}} \leq \sigma^2,$$ as the lower bound. 

:::{.callout-tip icon="false"}
## Confidence Intervals for the Sample Variance
For a normally distributed population, a confidence interval for the variance is formed by taking $$\left(\frac{(n-1)S^2}{\chi^2_{n-1,1-(1-p)/2}}, \frac{(n-1)S^2}{\chi^2_{n-1,(1-p)/2}}\right).$$ Here, the critical values from the $\chi^2$ distribution are given by the $1-(1-p)/2$ and $(1-p)/2$ quantiles, respectively. This is sometimes expressed using a different definition for the critical values. 
:::

Note that this derivation follows directly from knowledge of the sampling distribution of $S^2$. Had we been given a different result, we could have worked through the same procedure, resulting in different interval formula with the same underlying process. This specific result importantly relies on the assumption that the population is normally distributed. Were we in a situation where this is not the case, the formula does not hold, regardless of the size of the sample. To find confidence intervals for sample variances in non-normal populations, we require results regarding their sampling distributions.

It is also worth considering how we may use this result to form confidence intervals for standard deviations. Generally speaking, confidence intervals are **not** invariant to transformations. By this we mean that, even though $\sigma = \sqrt{\sigma^2}$, taking the confidence interval $(\sqrt{L(S^2)}, \sqrt{U(S^2)})$ will not result in an exact confidence interval for $\sigma$. Despite the fact that this will not generally be exactly correct, this is the procedure we tend to use. That is, if we have a confidence interval for a parameter, $\theta$, given by $$(L(\widehat{\theta}), U(\widehat{\theta})),$$ and we wish to have a confidence interval for some transformation, $g(\theta)$, we will typically use $$\left(g(L(\widehat{\theta})), g(U(\widehat{\theta}))\right).$$ As long as $g$ is a nicely behaved function, this will typically result in an acceptably close approximation.^[By nicely behaved, we mean monotonic. That is, if $a \leq b$, then $g(a) \leq g(b)$ or $g(a) \geq g(b)$ should hold. This means that taking $g(x) = \sqrt{x}$ is nicely behaved, but taking $g(x) = x^2$ is not. The concern with a function like $g(x) = x^2$ comes from what would happen if, for instance, our initial interval were $(-2, 2)$. Then transforming this interval gives $(4, 4)$ which is clearly incorrect. There are ways of working around this, however, considerations of more complex transformations are beyond the scope of these notes.] Supposing that we have a confidence interval for $\sigma^2$, then we can form a confidence interval for $\sigma$ simply by taking the square root of the endpoints. 

:::{#exm-variance-ci}
## Charles' Tufting Supplier Variability
```{r}
#| echo: false 
set.seed(31415) 
samples <- round(rnorm(6, 17, 2), 2)
```

Charles has been continuing to learn to tuft. One issue that has been coming up is in the variability of the durability of the yarn across different batches from the same supplier. Charles has found that it is important to approximately match the tensile strength of yarns on the same rug, otherwise it can lead to suboptimal results. Curious about how much variability there truly is in the tensile strength from the main supplier, Charles takes the following measurements: $$`r paste0(samples, collapse=", ");`.$$

a. What is the estimated variance of the yarn strength from this supplier?
b. How can Charles use this information to form a $95\%$ confidence interval for the strength of the yarn?
c. Supposing that a confidence interval is found for the variance as $(3.24, 49.0)$, what is a confidence interval for the standard deviation? Is this exact? Explain.

::::{.callout .solution collapse='true'}
## Solution
a. For the sample variance, we first need to get the sample mean. This is given by $$\frac{1}{6}\left(`r paste0(samples, collapse=" + ");`\right) = `r mean(samples)`.$$ Then, we take $$\begin{split}\frac{1}{6-1}\left(`r paste0("(", samples[1:3], " - ", mean(samples), ")^2", collapse = " + ")` \right. \\ \left. + `r paste0("(", samples[4:5], " - ", mean(samples), ")^2", collapse = " + ")`\right) = `r var(samples)`.\end{split}$$ 
b. To form the confidence interval in this setting we note that, assuming the observations are normally distributed, then the scaled sample mean will follow a $\chi^2_{n-1}$ distribution, where $n=6$. Thus, we take $$\left(\frac{(n-1)S^2}{\chi^2_{n-1,1-(1-p)/2}}, \frac{(n-1)S^2}{\chi^2_{n-1,(1-p)/2}}\right)$$ where $s^2 = `r var(samples)`$, $n=6$, and $p=0.95$. Plugging in, this gives $$\left(\frac{(5)(`r var(samples)`)}{\chi^2_{5,0.975}}, \frac{(5)(`r var(samples)`)}{\chi^2_{5,0.025}}\right).$$ If we use `R` to compute the critical values, this gives $(`r c(5*var(samples)/qchisq(0.975, 5), 5*var(samples)/qchisq(0.025, 5))`)$.
c. Given the interval $(3.24, 49.0)$, we can approximate a confidence interval for the standard deviation by square rooting the endpoints. This gives $(1.8, 7)$. This is not exact, since confidence intervals are not typically invariant to transformations. Instead, this will be approximate, but will typically be close enough in practice. 
::::
:::

## Margin of Error and Sample Sizing
When communicating the results of a scientific study, it is typically considered best practice to report confidence intervals alongside point estimates. This conveys the uncertainty in the estimate, and it gives the individual consuming the results the ability to make decisions based on the sensitivity of these results to the reported values. Knowing that you are likely to report a confidence interval, you can use the form of the confidence interval to make planning decisions regarding the study. 

When forming confidence intervals for the mean, all the intervals we considered took the form $\overline{X} \pm \Omega$, where $\Omega$ depended on the underlying variability, the sampling distribution, the degree of confidence, as well as the sample size. We call this term, the **margin of error**. 

:::{#def-margin-of-error}
## Margin of Error
In a symmetric confidence interval, the margin of error is defined to be the distance from the point estimate to the upper or lower confidence bounds. That is, a confidence interval for $\theta$ can be expressed as $$\widehat{\theta} \pm \text{M.E.}(\widehat{\theta}),$$ where $\text{M.E}(\widehat{\theta})$ corresponds to the margin of error. The width of a confidence interval is always $2\times\text{M.E.}$. 
:::

As noted previously, all else equal we would prefer a confidence interval that is less wide. This is equivalent to saying that we prefer a smaller margin of error. We can consider how the various choices that we make may influence the overall width of the confidence interval. Consider a normal population, with known variance. In this setting $$\text{M.E.}(\overline{X}) = Z_{1-(1-p)/2}\frac{\sigma}{\sqrt{n}}.$$ The three components of this formula are $p$, $\sigma$, and $n$. Note that, as $p$ increases, $1-(1-p)/2$ also increases, and so $Z_{1-(1-p)/2}$ will also increase. This means that if we want a higher $p$, the confidence interval must get wider.^[This should make intuitive sense. If you want to have a $80\%$ chance of containing the truth you can afford to give a narrower interval than if you wanted to have a $99\%$ chance of containing the truth.] Similarly, if $\sigma$ is larger, then the confidence interval will also be wider. This is not under control of the researcher, but it is to say that in more varied populations, confidence intervals will tend to be wider.^[This should also make intuitive sense. If we are trying to understand the center of a distribution, the more spread out our data are, the less certain we will be of our results. The less spread out, the more certain we can be.] Finally, we see that as $n$ increases, the width of the confidence interval will decrease. This is a choice that the researcher gets to make.

Noting that as the sample size increases the width of the confidence interval decreases, we can use this relationship to decide what sample size our study should rely on. Specifically, if a researcher knows the variance (or has an estimated value for the sample variance), then they can determine what $n$ is required in order to achieve a set margin of error. For instance, perhaps you want to have a $99\%$ confidence interval that will give a margin of error of no more than $0.01$. By setting the margin of error equal to $0.01$, and taking $p = 0.99$, you can determine that $$n \geq \left(Z_{0.995}\frac{\sigma}{0.01}\right)^2.$$ As long as the value for $\sigma$ is correct, this will guarantee the desired result.

:::{#exm-sample-sizing-for-ci}
## Tensile Strength Averages
Charles has been continuing to deal with high variability in the tensile strength of the main yarn supplier. There is another possible supplier to use, however, Charles wants to be very sure that the average tensile strength of the new supplier's yarn is acceptable as well. Charles will be happy if a $90\%$ confidence interval is within $0.1$ of the true average tensile strength. From experience and word-of-mouth, Charles suspects that the new supplier has a tensile strength variability of approximately $4$. 

a. How many balls of yarn should Charles buy in order to form the desired confidence interval?
b. What if Charles were content with being within $1$ of the true average?
b. Suppose that instead of estimating the average, Charles wants to estimate the proportion of balls of yarn from the new supplier with a strength that exceeds that of the old supplier. To do so, Charles buys pairs of balls of yarn, and compares the strength of each of them, reporting whether the new supplier is higher or lower. Approximately how many pairs of balls of yarn would be required so that the proportion can be estimated to within $0.01$ of the true proportion, with $95\%$ confidence?

::::{.callout .solution collapse='true'}
## Solution

a. Here, Charles wants a margin of error equal to $0.1$. We know that, in this case, the approximate value for the margin of error will be $$Z_{1-(1-p)/2}\frac{\sigma}{\sqrt{n}} = 1.64\frac{2}{\sqrt{n}}.$$ Thus, we solve \begin{align*}
1.64\frac{2}{\sqrt{n}} &\leq 0.1 \\
\frac{3.28}{0.1} \leq \sqrt{n} \\
32.8^2 \leq n \\
1075.84 \leq n.
\end{align*} Therefore, Charles would need to buy at least $1076$ balls of yarn to have the level of confidence desired in the tensile strength.
b. To be within $1$, we solve the same expression as in (a) but for a margin of error of $1$. This results in $n \geq 3.28^2 = 10.8$, and so in this case Charles would need to purchase $11$ balls of yarn. 
b. Here, we wish to estimate a proportion within $0.01$ of the truth. To do so, recognize that we can take the normal approximation for the confidence interval, which gives a margin of error equal to $$Z_{1-(1-p)/2}\sqrt{\frac{p(1-p)}{n}}.$$ In principle, we can solve for this equal to $0.01$. However, it is important to note that we should take a conservative approach to $p$ here. The most variability will come when $p=0.5$, and so we should estimate the population variance to be based on $p=0.5$. This gives \begin{align*}
Z_{0.975}\sqrt{\frac{0.5^2}{n}} &\leq 0.01 \\
\frac{1.96(0.5)}{0.01} &\leq \sqrt{n} \\
9.8^2 &\leq n \\
96.04 \leq n.
\end{align*} There should be at least $97$ pairs of balls of yarn purchased to have this degree of confidence in the proportion estimate.
::::
:::

## Confidence Intervals in R
The primary utility of `R` in terms of forming confidence intervals is in making it easy to determine the critical values for the required distribution. Recall from earlier chapters that the critical values for distributions are typically given by `q{distname}`, where `distname` is the relevant distribution. That is, should you want the critical values for a normally distributed population, you can use `qnorm(1 - (1-p)/2)`, where `p` is the relevant level. This can then be supplemented with relevant calls to `mean`, `sd`, and `var` to form the various intervals. 

::: {.content-visible when-format='pdf'}
```{r}
set.seed(31415) 
p <- 0.95

# Suppose we observe data from a normal
observations <- rnorm(100, 5, 2)

# We can form confidence intervals depending on our assumptions
Xbar <- mean(observations)
s <- sd(observations)
Z_crit <- qnorm(1 - (1-p)/2)
t_crit <- qt(1 - (1-p)/2, df = 99)

# Assume sigma = 2 is known
c(Xbar - Z_crit * 2/sqrt(100), Xbar + Z_crit * 2/sqrt(100))

# Assume sigma is not known
c(Xbar - t_crit * s/sqrt(100), Xbar + t_crit * s/sqrt(100))
```
:::
::: {.content-visible when-format='html'}
```{webr-r}
set.seed(31415) 
p <- 0.95

# Suppose we observe data from a normal
observations <- rnorm(100, 5, 2)

# We can form confidence intervals depending on our assumptions
Xbar <- mean(observations)
s <- sd(observations)
Z_crit <- qnorm(1 - (1-p)/2)
t_crit <- qt(1 - (1-p)/2, df = 99)

# Assume sigma = 2 is known
c(Xbar - Z_crit * 2/sqrt(100), Xbar + Z_crit * 2/sqrt(100))

# Assume sigma is not known
c(Xbar - t_crit * s/sqrt(100), Xbar + t_crit * s/sqrt(100))
```
:::

In the coming modules we will see ways of calculating confidence intervals less directly, however, these procedures are designed for alternative purposes and thus are unnecessary when all that is desired is a confidence interval.

## Exercises {.unnumbered}

:::{#exr-14.01}
Derive the confidence interval for $\mu$ in a normal population assuming that $\sigma^2$ is unknown. You may use the fact that $$\frac{\overline{X} - \mu}{s/\sqrt{n}} \sim t_{n-1}.$$
:::

:::{#exr-14.02}
Consider the following questions regarding the interpretation of confidence intervals.

a. The 99\% confidence interval for the average heart rate after a workout is [110 bpm, 120 bpm]. What does this mean?
a. An automotive company calculates a 99\% confidence interval for the fuel efficiency of a new model as [25 mpg, 28 mpg]. How confident are they that the true mean falls within this interval?
a. A software development team establishes an 80\% confidence interval for the response time of a new application as [150 ms, 180 ms]. Explain the implications of this interval for user experience.
a. A clinical trial calculates a 95\% confidence interval for the reduction in blood pressure due to a new drug as [8 mmHg, 12 mmHg]. Interpret this interval in the context of the drug's effectiveness.
a. A study examines the impact of social media advertising on consumer purchasing behavior by randomly assigning participants to view different ads and measuring their subsequent purchases. Is this study observational or experimental?
a. A civil engineering project calculates a 99\% confidence interval for the lifespan of a particular bridge as [50 years, 70 years]. How confident are the engineers that the bridge's true lifespan falls within this range?
a. In a historical study, a historian calculates an 80\% confidence interval for the birth year of a famous artist as [1650, 1680]. What does this interval suggest about the artist's birth year?
a. An electronic component manufacturer determines a 95\% confidence interval for the failure rate of a product as [0.8\%, 1.2\%]. Interpret this interval in terms of product reliability.
a. A medical study calculates a 90\% confidence interval for the reduction in symptoms due to a treatment as [30\%, 40\%]. How should healthcare practitioners interpret this interval?
a. A manufacturing process is being tested for its efficiency. The 90\% confidence interval for the defect rate is [2.5\%, 3.2\%]. Explain what this interval means in the context of the process.
a. A psychological study establishes an 99\% confidence interval for the decrease in anxiety scores after a therapeutic intervention as [12 points, 20 points]. Explain what this interval conveys about the intervention's impact.
a. A survey on music preferences establishes a 90\% confidence interval for the percentage of individuals who enjoy classical music as [15\%, 20\%]. Explain how confident we are in the accuracy of this interval.
a. In a structural engineering study, a 95\% confidence interval for the tensile strength of a certain material is calculated as [40 MPa, 45 MPa]. Interpret this interval.
a. A survey on travel habits finds that a 95\% confidence interval for the average number of vacations people take per year is [1.8, 2.5]. Interpret this interval in the context of the survey results.
a. The 95\% confidence interval for the survival rate of patients post-surgery is [85\%, 90\%]. What does this interval suggest about the effectiveness of the surgical procedure?
:::

:::{#exr-14.03}
Consider a normal population distribution with the value of $\sigma$ known. 

a. What is the confidence level for the interval $\overline{x} \pm 2.81\frac{\sigma}{\sqrt{n}}$?
a. What is the confidence level for the interval $\overline{x} \pm 1.44\frac{\sigma}{\sqrt{n}}$?
a. What is the value for $Z_{\alpha/2}$ to form a $99.7\%$ confidence interval?
a. What is the value for $Z_{\alpha/2}$ to form a $75\%$ confidence interval?

:::

:::{#exr-14.04}
The following are two confidence intervals for $\mu$, the true average resonance frequency (in Hz) for tennis rackets of a certain type, computed on the same sample. $A = (114.4, 115.6)$ and $B = (114.1, 115.9)$. 

a. What is the value of the sample mean? 
a. One of these confidence intervals is a $90\%$ interval, the other is a $99\%$ interval. Which is which? Why?

:::

:::{#exr-14.05}
A random sample of $50$ bottles of a brand of cough syrup is selected and have their alcohol content determined. If $\mu$ is the average alcohol content for the population of all bottles under study, then suppose that a $95\%$ confidence interval for $\mu$ is computed as $(7.8, 9.4)$. 

a. Would a $90\%$ confidence interval calculated from this sample have been narrower or wider than the given interval? Why?
a. Is the following statement correct? Why? "There is a $95\%$ chance that $\mu$ is between $7.8$ and $9.4$."
a. Is the following statement correct? Why? "We can be highly confident that $95\%$ of bottles of this type of cough syrup have an alcohol content that is between $7.8$ and $9.4$."
a. Is the following statement correct? Why? "If the process of selecting a sample of size $50$ then computing the corresponding $95\%$ interval is repeated $100$ times, $95$ of the resulting intervals will include $\mu$."

:::

:::{#exr-14.06}
Suppose that the true standard deviation for helium porosity of coal samples is $0.75$, and the measurements are assumed to be normally distributed. 

a. Construct a $95\%$ confidence interval assuming a sample of size $20$ resulted in a sample mean of $4.85$.
a. How many observations are necessary to estimate the true average within $0.2$ with $99\%$ confidence?
a. What if $s = 0.75$ rather than $\sigma = 0.75$: can you still answer the previous questions?
:::

:::{#exr-14.07}
In a sample of $100$ steel wires, the average breaking strength is $50$ kN. The population standard deviation is $2$ kN. 

a. Find a $95\%$ confidence interval for the mean breaking strength of this wire.
a. Find a $99\%$ confidence interval for the mean breaking strength of this wire.
a. If an engineer claims that the mean breaking strength is $49.7$ to $50.3$, what level of confidence is the engineer using?
a. How many wires must be sampled so that a $95\%$ confidence interval specifies the mean breaking strength to within $\pm 0.3$ kN?
a. What if $s = 2$ rather than $\sigma = 2$?: can you still answer the previous questions?
:::

:::{#exr-14.08}
In a random sample of $53$ concrete specimens, the average porosity was $21.6$. The population standard deviation is $3.2$. 

a. Find a $90\%$ confidence interval for the mean porosity.
a. Find a $95\%$ confidence interval for the mean porosity.
a. How many specimens must be sampled so that the $95\%$ confidence interval specifies the mean to within $\pm 0.3$?
a. What if $s = 3$ rather than $\sigma = 3$: can you still answer the previous questions?
:::

:::{#exr-14.09}
a. By how much must the sample size $n$ be increased if the width of a CI is to be halved? 
a. Increasing the sample size by a factor of $25$ will have what impact on the width of the CI?
:::

:::{#exr-14.10}
Consider a $100\times(1-\alpha)\%$ confidence interval for the mean of a normal distribution with known variance, $\sigma^2$, based on a random sample of $n$ observations. How does the width of the interval change as 

a. $n$ is increased, holding everything else constant.
a. $\sigma^2$ is increased, holding everything else constant.
a. $\alpha$ is decreased, holding everything else constant.
a. Suppose the standard deviation of a certain electrical component is $144$ hours: how large of a sample must be taken to be $95\%$ confident that the error in the estimated mean lifetime of such components will not exceed $15$ hours?
:::

:::{#exr-14.12}
In measuring reaction times, a psychologist estimates that the standard deviation is $0.05$ seconds. How large of a sample of measurements must be taken in order to be confident that the error in their estimates of mean reaction time will not exceed $0.01$ seconds, assuming:

a. They want to be $95\%$ confident?
a. They want to be $99\%$ confident?

:::

:::{#exr-14.13}
A company wishes to understand whether its recruiting practices are disproportionately aimed at men; to do so, they wish to understand the proportion, $p$, of applicants to their positions who do not identify as male. In a random sample of $80$ applications, it found that $22$ were from non-male identified individuals. 

a. Find an approximate $90\%$ confidence interval for $p$, and indicate what assumptions are necessary for the approximation to be valid.
a. If the company wishes to estimate the true proportion with a precision of $\pm0.02$, at a $90\%$ level of confidence, how many more applications must they look at to achieve this result?

:::

:::{#exr-14.14}
In an experiment to test whether final digits of telephone numbers are random, a random sample of $40$ digits is selected from a large telephone directory. The null hypothesis of randomness will fail to be rejected if there are at least $17$ but not more than $22$ even digits in the sample, and will be rejected otherwise. 


a. Using a suitable approximation, find the probability of a Type I error.
a. A friend of yours claims that in fact more telephone numbers are odd than even. How would you check whether this is true, using a $5\%$ test based on a random sample of size $50$?

:::

:::{#exr-14.15}
Suppose that the following output was obtained from a sample of tensile strength observations. Using these statistics, compute a $99\%$ confidence interval for the true average tensile strength, and interpret the result. 

|   N   |   Mean   |  Median  | Std. Dev | SE. Mean | Minimum  | Maximum  |
| :---: | :------: | :------: | :------: | :------: | :------: | :------: |
| $153$ | $135.39$ | $135.40$ |  $4.59$  |  $0.37$  | $122.20$ | $147.70$ |
:::

:::{#exr-14.16}
An investigator computes a $95\%$ confidence interval for a population mean on the basis of a sample of size $70$. If they wish to compute a $95\%$ confidence interval that is half as wide, how large of a sample is required?

:::

:::{#exr-14.17}
A $95\%$ confidence interval for a population mean is computed from a sample of size $400$. Another $95\%$ confidence interval will be computed from a sample of size $100$ drawn from the sample population. What will be the approximate ratio of the length of the first interval to the length of the second?

:::

:::{#exr-14.18}
Based on a large sample of capacitors of a certain type, a $95\%$ confidence interval for the mean capacitance was computed to be $(0.213, 0.241)$. Find a $90\%$ confidence interval for the mean capacitance of this type of capacitor. 

:::

:::{#exr-14.19}
Based on a sample of repair records, an engineer calculates a $95\%$ confidence interval for the mean cost to repair a fiber-optic component to be $(140, 160)$. A supervisor summarizes this result saying "We are $95\%$ confident that the mean cost of repairs is less than \$160." Is the supervisor underestimating, overestimating, or getting the confidence of this statement correct? Why?

:::

:::{#exr-14.20}
A random sample of $400$ electronic components manufactured by a certain process are tested, and $30$ are found to be defective. 

a. Let $p$ represent the proportion of components manufactured by this process that are defective. Find a $95\%$ confidence interval for $p$.
a. How many components must be sampled so that the $95\%$ confidence interval will specify the proportion to within $\pm 0.02$?
a. A device will be manufactured in which two components are connected in series. The components function independently, and the device functions only if both components function. Let $q$ be the probability that the device functions. Find a $95\%$ confidence interval for $q$. 
a. **Challenge:** The company ships the components in lots of $200$. Lots containing more than $20$ defective components are returned. Find a $95\%$ confidence interval for the proportion of lots that will be returned.

:::

:::{#exr-14.21}
A stock market analyst notices that in a certain year, the price of IBM stock increased on $131$ of $252$ trading days. Can these data be used to find a $95\%$ confidence interval for the proportion of days that IBM stock increases? Explain.

:::

:::{#exr-14.22}
Measurements of the diameters of a random sample of $200$ ball bearings made by a certain machine during one week showed a mean of $0.84$ inches and a standard deviation of $0.042$ inches. Find $95\%$ and $99\%$ confidence intervals for the diameter of all the ball bearings.
:::

:::{#exr-14.23}
What are the values for each of the following quantities? 

a. $t_{0.1, 15}$;
a. $t_{0.05, 15}$;
a. $t_{0.05, 25}$;
a. $t_{0.05, 40}$;
a. $t_{0.005, 40}$.

:::

:::{#exr-14.24}
A sample of $14$ joint specimens of a particular type gave a sample mean proportional limit stress of $8.48$ MPa and a sample standard deviation of $0.79$ MPa. 

a. Calculate and interpret a $95\%$ confidence interval for the true average proportional limit stress. 
b. Suppose that it is later determined that the true, population standard deviation is $3.1804$ MPa. What is the coverage probability of an interval formed using the interval estimator in (a)?

:::

:::{#exr-14.25}
A normal probability plot of $n=26$ observations shows a substantial linear pattern. The sample mean and sample standard deviation are $370.69$ and $24.36$, respectively. Compute a $95\%$ confidence interval for the population mean.

:::

:::{#exr-14.26}
A colleague computes a $95\%$ confidence interval using a normal approximation in a sample of $n \ll 30$, where the standard deviation was estimated as $s$. How many times longer would the correct confidence interval be?
:::

:::{#exr-14.27}
A sample of $10$ measurements of the diameter of a sphere gave a mean of $\overline{x} = 4.38$ inches and a standard deviation $s=0.06$ inches. Find $95\%$ and $99\%$ confidence intervals for the actual diameter.

:::

:::{#exr-14.28}
Measurements for the chemical analysis of runoff water from sawmills in British Columbia are taken. Six measurements for the water's pH are recorded as: $5.9$, $5.0$, $6.5$, $5.6$, $5.9$, and $6.5$. If these are a random sample from an approximately normally distributed population, find a $95\%$ confidence interval for the true pH.
:::

:::{#exr-14.29}
Fission tracks are trails found in uranium-bearing minerals, left by fragments released during fission events. Fifteen tracks on one rock specimen had an average track length of $13$ $\mu$m with a standard deviation of $2$ $\mu$m. If the population is approximately normal, find a $99\%$ confidence interval for the mean track length for this rock specimen.
:::

:::{#exr-14.30}
The following output is generated from statistical software computing the confidence interval for a population mean. 

| Variable | $N$ | Mean | Std. Dev | S.E. Mean | $95\%$ CI |
|:-:|:-:|:-:|:-:|:-:|:-:|
| $X$ | $10$ | $6.59635$ | $0.11213$ | $0.03546$ | $(6.51513, 6.67656)$ |

a. How many degrees of freedom does the $t$ distribution have?
b. Using the information in the table, find a $99\%$ confidence interval for the mean.
c. Suppose that the population standard deviation is determined to be $0.3$. What is the coverage probability of the interval estimator from part (b)?
:::

:::{#exr-14.31}
The concentration of carbon monoxide in a gas sample is measured by a spectrophotometer and found to be $85$ppm. Through long experience with this instrument it is believed that its measurements are unbiased and normally distributed, with a standard deviation of $8$ppm. Find a $95\%$ confidence interval for the concentration of CO in this sample. 
:::

:::{#exr-14.32}
Determine the values for the following quantities 

a. $\chi^2_{0.1, 15}$;
a. $\chi^2_{0.1, 25}$;
a. $\chi^2_{0.01, 25}$;
a. $\chi^2_{0.005, 25}$;
a. $\chi^2_{0.99, 25}$;
a. $\chi^2_{0.995, 25}$.
:::

:::{#exr-14.33}
The amount of lateral expansion was determined for a sample of $n=9$ pulsed-power gas metal arc welds used in LNG ship containment tanks. The resulting sample standard deviation was $2.81$. Assuming normality, derive a $95\%$ confidence interval for $\sigma^2$ and $\sigma$.
:::

:::{#exr-14.34}
Wire electrical-discharge machining (WEDM) is a process used to manufacture conductive hard metal components. It uses a continuously moving wire that serves as an electrode. Coating on the wire electrode allows for cooling of the wire electrode core and provides an improved cutting performance. A sample of eight wire electrodes used had a coating layer thickness measured as: $21$, $16$, $29$, $35$, $42$, $24$, $24$, and $25$. Find a $99\%$ CI for the standard deviation of the coating layer thickness. Is this a valid interval? 
:::

:::{#exr-14.35}
Suppose that a group of researchers decides to estimate the interval for a population proportion by taking $\widehat{p} \pm \frac{1}{n}$. If the sample size is large enough to use the normal approximation, what is the approximate coverage probability of this interval?
:::